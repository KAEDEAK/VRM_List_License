# VRM_List_License
VRMファイル解析＆フォルダ振り分けツール 使い方ドキュメント

**免責事項:**  
本ツールは「現状のまま」提供されるものであり、使用者自身の責任においてご利用ください。本ツールの使用または使用不能に起因するいかなる損害についても、開発者は一切の責任を負いません。  
ご利用の前に、必ず対象ファイルのバックアップを取得し、ソースコードを確認した上でご使用ください。

このツールは、VRMファイルから利用許諾・利用制限関連のメタデータを抽出し、一覧表示、JSON/CSV出力、指定ルールに基づいたファイルのフォルダ振り分けを実現するツールです。

※ **Python 3.6** 以降で動作します。

---

## 1. 基本の動作

### 1-1. VRMファイルの一覧表示

```
py list_license.py -path <パスパターン>
```

- **例:**
  ```
  py list_license.py -path test\*.vrm
  ```
- **動作:**
  指定したパス（ワイルドカード指定OK）にあるVRMファイルを再帰的にスキャンし、各ファイルの利用許諾情報をコンソールに一覧表示します。

### 1-2. 生JSON出力

```
py list_license.py -path <パスパターン> -json
```

- **例:**
  ```
  py list_license.py -path test\*.vrm -json
  ```
- **動作:**
  各VRMファイルのパース済みJSONを、 `"files": [ { "filename": "XXX", "metadata": { ... } }, ... ]` の形式で1つにまとめて出力します。

### 1-3. CSV出力

```
py list_license.py -path <パスパターン> -output <CSVファイル名>
```

- **例:**
  ```
  py list_license.py -path test\*.vrm -output list.csv
  ```
- **動作:**
  指定したVRMファイルの利用許諾情報を抽出し、統一フォーマットのCSVファイルとして出力します。

---

## 2. フォルダ振り分け機能

利用許諾・利用制限情報に基づいて、VRMファイルを自動的にフォルダへ移動する機能です。振り分けの流れは大きく「準備モード」と「ソートモード」の2段階になります。

### ステップ1: mapdata.json の作成（準備モード）

まず、対象のVRMファイルから利用許諾・利用制限関連のメタ情報を全て収集して、**重複しない key-value** 形式で `mapdata.json` を自動生成します。

```
py list_license.py -path <パスパターン> -mapToFolder -prepare <mapdata.jsonのパス>
```

- **例:**
  ```
  py list_license.py -path test\*.vrm -mapToFolder -prepare mapdata.json
  ```
- **出力される mapdata.json のサンプル:**

```json
{
  "mapdata": {
    "unsort": {
      "target": {
        "allowedUserName": ["Everyone", "OnlyAuthor"],
        "commercialUssageName": ["Disallow", "Allow"],
        "licenseName": "Other",
        "sexualUssageName": ["Disallow", "Allow"],
        "violentUssageName": ["Disallow", "Allow"],
        "licenseUrl": "https://vrm.dev/licenses/1.0/",
        "avatarPermission": "everyone",
        "allowExcessivelyViolentUsage": true,
        "allowExcessivelySexualUsage": true,
        "commercialUsage": ["personalNonProfit", "corporation"],
        "creditNotation": ["unnecessary", "required"],
        "allowRedistribution": [false, true],
        "modification": ["allowModificationRedistribution", "prohibited", "allowModification"]
      }
    },
    "sorted": [{
        "directory": "folder-1",
        "target": {}
      }, {
        "directory": "folder-2",
        "target": {}
      }, {
        "directory": "DoNotUse",
        "target": {}
      }
    ]
  }
}
```

- ** mapdata.json の編集例:**

```json
{
  "mapdata": {
    "unsort": {
      "target": {
        "allowedUserName": ["This value is automatically generated by the -prepare parameter."]
      }
    },
    "sorted": [{
        "directory": "OpenUse",
        "target": {
          "allowedUserName": ["OnlyAuthor"],
          "commercialUssageName": ["Allow"],
          "sexualUssageName": ["Allow"],
          "violentUssageName": ["Allow"],
          "avatarPermission": "everyone",
          "allowExcessivelyViolentUsage": true,
          "allowExcessivelySexualUsage": true,
          "commercialUsage": ["corporation", "personalNonProfit"],
          "creditNotation": ["unnecessary"],
          "allowRedistribution": [true],
          "modification": ["allowModification", "allowModificationRedistribution"]
        }
      }, {
        "directory": "LimitedUse",
        "target": {
          "allowedUserName": ["Everyone"],
          "commercialUssageName": ["Allow"],
          "allowRedistribution": [true]
        }
      }, {
        "directory": "ReviewRequired",
        "target": {}
      }
    ]
  }
}
```

- **ポイント:**
  - `unsort.target` には、ツールがスキャンして収集した利用許諾・利用制限関連のキーと値が記録されます。
  - `sorted` セクションは、ユーザーが後から編集して各フォルダへの振り分けルール（条件）を設定する部分です。
  - ※ JSON の書式は正しく、**キーと文字列はダブルクォーテーション**で囲むこと。booleanやintegerはそのままでOK！

### ステップ2: mapdata.json に基づくファイル振り分け（ソートモード）

mapdata.json を編集して、各フォルダへ移動する条件（target）を設定したら、以下のコマンドでファイル振り分けを実行します。

```
py list_license.py -path <パスパターン> -mapToFolder -sortBy <mapdata.jsonのパス>
```

- **例:**
  ```
  py list_license.py -path test\*.vrm -mapToFolder -sortBy mapdata.json
  ```
- **動作のポイント:**
  - 各 mapping の `target` に記載された key-value 条件は **AND 条件** で評価されます。  
    → 複数の条件がある場合、すべて一致したファイルだけがそのディレクトリへ移動されます。
  - もしどの mapping の条件にも合致しなかった場合、 `directory` が `"ReviewRequired"` で `target` が空のエントリーがあれば、そのフォルダへ移動されます。

---

## 3. 補足と注意点

- **Python環境:**
  Python 3.6 以降で動作します。必要なライブラリは標準ライブラリのみです。

- **JSONの書式について:**
  - 文字列は必ずダブルクォーテーション `" "` で囲む
  - boolean（true, false）や整数はそのままでOK！
  - 余分なカンマが入らないように注意してください。
  - JSONLint などで書式チェックすると安心です。

- **対象ファイル:**
  VRM 0.x および VRM 1.0 のファイルに対応しています。それ以外の形式は処理されませんので注意してください。

---
